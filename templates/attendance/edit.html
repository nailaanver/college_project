{% extends 'base.html' %}
{% load static %}
{% load attendance_extras %}


{% block content %}

<div class="edit-attendance-wrapper">

  <h2 class="page-title">
    <i class="fa-solid fa-pen-to-square"></i> Edit Attendance
  </h2>

  <p class="class-info">
    Period {{ timetable.period_number }} |
    {{ timetable.course }} |
    Sem {{ timetable.semester }} |
    {{ timetable.subject.name }}
  </p>

  <form method="post">
    {% csrf_token %}

    <div class="attendance-grid">

      {% for s in students %}
      {% with attendance_map|get_item:s.id as status %}
      <div class="student-card">

        <img
          src="{% if s.profile_photo %}{{ s.profile_photo.url }}{% else %}{% static 'images/default_profile.png' %}{% endif %}"
          class="avatar"
        >

        <div class="student-name">
          {{ s.first_name }} {{ s.last_name }}
        </div>

        <div class="status-buttons">

          <label class="status present">
            <input type="radio" name="status_{{ s.id }}" value="P"
                   {% if status == 'P' %}checked{% endif %}>
            <span>P</span>
          </label>

          <label class="status absent">
            <input type="radio" name="status_{{ s.id }}" value="A"
                   {% if status == 'A' %}checked{% endif %}>
            <span>A</span>
          </label>

          <label class="status late">
            <input type="radio" name="status_{{ s.id }}" value="L"
                   {% if status == 'L' %}checked{% endif %}>
            <span>L</span>
          </label>

        </div>

      </div>
      {% endwith %}
      {% endfor %}

    </div>

    <div class="submit-wrap">
      <button class="submit-btn" type="submit">
        Update Attendance
      </button>
    </div>

  </form>

</div>

<style>
/* ===== WRAPPER ===== */
.edit-attendance-wrapper {
  max-width: 1100px;
  margin: auto;
}

/* ===== TITLE ===== */
.page-title {
  text-align: center;
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 6px;
  color: #142850;
}

.class-info {
  text-align: center;
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 25px;
}

/* ===== GRID ===== */
.attendance-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  gap: 18px;
}

/* ===== STUDENT CARD ===== */
.student-card {
  background: #fff;
  border-radius: 14px;
  padding: 16px 12px;
  text-align: center;
  border: 1px solid #edf0f5;
  transition: transform 0.2s, box-shadow 0.2s;
}

.student-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 18px rgba(0,0,0,0.08);
}

/* ===== AVATAR ===== */
.avatar {
  width: 62px;
  height: 62px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 10px;
  border: 2px solid #142850;
}

/* ===== NAME ===== */
.student-name {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #1f2937;
}

/* ===== STATUS BUTTONS ===== */
.status-buttons {
  display: flex;
  justify-content: center;
  gap: 8px;
}

.status {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  cursor: pointer;
}

.status input {
  display: none;
}

.status span {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
  border-radius: 50%;
  font-size: 12px;
  font-weight: 600;
  transition: transform 0.2s;
}

.status:hover span {
  transform: scale(1.1);
}

/* soft professional colors */
.present span { background: #eafaf1; color: #198754; }
.absent span  { background: #fdeaea; color: #dc3545; }
.late span    { background: #fff4e5; color: #fd7e14; }

.status input:checked + span {
  box-shadow: inset 0 0 0 2px currentColor;
}

/* ===== SUBMIT ===== */
.submit-wrap {
  text-align: center;
  margin-top: 30px;
}

.submit-btn {
  background: #142850;
  color: #fff;
  padding: 12px 34px;
  border-radius: 24px;
  border: none;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
}

.submit-btn:hover {
  background: #1f3a6d;
  transform: scale(1.05);
}

/* ===== MOBILE ===== */
@media (max-width: 480px) {
  .attendance-grid {
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  }
}
</style>

{% endblock %}
