{% extends 'base.html' %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
:root {
    --navy-dark: #0b1c39;
    --navy: #142850;
    --gold: #f3c623;
    --white: #ffffff;
    --danger: #ef4444;
    --success: #10b981;
    --light-gray: #f8f9fa;
}

/* Page Background */
.report-page {
    min-height: 100vh;
    background: linear-gradient(rgba(11,28,57,0.94), rgba(11,28,57,0.94)),
                url("{% static 'images/campus.jpg' %}") center/cover no-repeat fixed;
    padding: 60px 20px;
    font-family: 'Poppins', sans-serif;
}

/* Main Dashboard Card */
.report-container {
    max-width: 1200px;
    margin: 0 auto;
    background: var(--white);
    padding: 40px;
    border-radius: 30px;
    box-shadow: 0 25px 60px rgba(0,0,0,0.5);
}

/* Header */
.report-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    border-bottom: 2px solid var(--light-gray);
    padding-bottom: 20px;
}

.report-header h2 {
    color: var(--navy-dark);
    font-weight: 800;
    font-size: 32px;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 15px;
}

.report-header h2 i {
    color: var(--gold);
}

/* Stat Grid */
.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    padding: 25px;
    border-radius: 20px;
    color: white;
    position: relative;
    overflow: hidden;
}

.stat-card.fines { background: linear-gradient(135deg, #142850, #0b1c39); }
.stat-card.issued { background: linear-gradient(135deg, #10b981, #059669); }
.stat-card.overdue { background: linear-gradient(135deg, #ef4444, #b91c1c); }

.stat-card h3 { font-size: 14px; text-transform: uppercase; opacity: 0.8; margin: 0; }
.stat-card .value { font-size: 28px; font-weight: 700; margin: 10px 0 0 0; display: block; }
.stat-card i { position: absolute; right: 20px; bottom: 20px; font-size: 40px; opacity: 0.2; }

/* Section Headings */
h4 {
    color: var(--navy-dark);
    font-size: 18px;
    font-weight: 700;
    margin: 40px 0 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.overdue-title { color: var(--danger); }

/* Table Styling */
.table-wrapper {
    background: var(--white);
    border: 1px solid #eee;
    border-radius: 15px;
    overflow: hidden;
}

table {
    width: 100%;
    border-collapse: collapse;
}

thead { background: var(--light-gray); }

th {
    padding: 15px 20px;
    text-align: left;
    font-size: 12px;
    text-transform: uppercase;
    color: #666;
    letter-spacing: 1px;
}

td {
    padding: 15px 20px;
    border-bottom: 1px solid #f2f2f2;
    font-size: 14px;
    color: var(--navy-dark);
}

.status-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
}

.badge-issued { background: rgba(16, 185, 129, 0.1); color: var(--success); }
.badge-fine { font-weight: 700; color: var(--danger); }

/* Responsive */
@media (max-width: 768px) {
    .report-header { flex-direction: column; gap: 20px; text-align: center; }
    .stat-grid { grid-template-columns: 1fr; }
    table, thead, tbody, th, td, tr { display: block; }
    thead tr { display: none; }
    td { text-align: right; padding-left: 50%; position: relative; border-bottom: 1px solid #eee; }
    td::before { content: attr(data-label); position: absolute; left: 20px; font-weight: 700; color: #999; }
}
</style>

<div class="report-page">
    <div class="report-container">

        <div class="report-header">
            <h2><i class="fas fa-chart-pie"></i> Library Analytics</h2>
            <a href="{% url 'library-menu' %}" class="btn-back">
                <i class="fas fa-arrow-left"></i> Back to Menu
            </a>
        </div>

        <div class="stat-grid">
            <div class="stat-card fines">
                <h3>Total Fines</h3>
                <span class="value">₹{{ total_fines }}</span>
                <i class="fas fa-wallet"></i>
            </div>
            <div class="stat-card issued">
                <h3>Active Loans</h3>
                <span class="value">{{ issued_books|length }}</span>
                <i class="fas fa-book-reader"></i>
            </div>
            <div class="stat-card overdue">
                <h3>Overdue Items</h3>
                <span class="value">{{ overdue_books|length }}</span>
                <i class="fas fa-clock"></i>
            </div>
        </div>

        <h4><i class="fas fa-list-ul"></i> Circulation List</h4>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Book Details</th>
                        <th>Borrower</th>
                        <th>Issue/Due Dates</th>
                        <th>Status</th>
                        <th>Fine</th>
                    </tr>
                </thead>
                <tbody>
                    {% for issue in issued_books %}
                    <tr>
                        <td data-label="Book Details"><strong>{{ issue.book.title }}</strong></td>
                        <td data-label="Borrower">{{ issue.user.username }}</td>
                        <td data-label="Dates">
                            <small>{{ issue.issue_date }} <i class="fas fa-arrow-right" style="font-size: 10px;"></i> {{ issue.due_date }}</small>
                        </td>
                        <td data-label="Status">
                            <span class="status-badge badge-issued">{{ issue.status }}</span>
                        </td>
                        <td data-label="Fine" class="badge-fine">
                            {% if issue.fine %}₹{{ issue.fine }}{% else %}—{% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" style="text-align:center; padding: 40px; color: #999;">No books are currently issued.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <h4 class="overdue-title"><i class="fas fa-exclamation-circle"></i> Overdue Alerts</h4>
        <div class="table-wrapper" style="border-top: 3px solid var(--danger);">
            <table>
                <thead>
                    <tr>
                        <th>Book Details</th>
                        <th>Borrower</th>
                        <th>Expected Return</th>
                        <th>Current Fine</th>
                    </tr>
                </thead>
                <tbody>
                    {% for issue in overdue_books %}
                    <tr>
                        <td data-label="Book Details"><strong>{{ issue.book.title }}</strong></td>
                        <td data-label="Borrower">{{ issue.user.username }}</td>
                        <td data-label="Return Date">{{ issue.due_date }}</td>
                        <td data-label="Fine" class="badge-fine">
                            ₹{{ issue.fine }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" style="text-align:center; padding: 40px; color: #999;">No overdue books. Excellent!</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

{% endblock %}